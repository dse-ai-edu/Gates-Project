<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profile Grading Interface</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f9f9f9;
            margin: 0;
            padding: 2rem;
            overflow-x: hidden;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .section {
            background: #fff;
            padding: 2rem;
            margin-bottom: 2rem;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .section h2 {
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        select,
        textarea {
            width: 100%;
            padding: 0.75rem;
            font-size: 1rem;
            margin-top: 0.5rem;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        textarea {
            height: 150px;
            resize: vertical;
        }
    </style>
    <script src="{{ url_for('static', filename='js/step4.js') }}"></script>
    <script src="{{ url_for('static', filename='js/utils.js') }}"></script>
    <script>
        localStorage['userId'] = 'test'
        window.onload = function () {
            loadSession();
            loadTask();
        }
    </script>
</head>

<body>
    <div class="container">

        <!-- Profile Selector -->
        <div class="section">
            <h2>Select Task</h2>
            <select id="task-select">
                <option value="">Select a task</option>
            </select>
            <p id="toggle-rubrics" style="color: blue; text-decoration: underline; cursor: pointer; display: none;">Show
                Details</p>
        </div>

        <!-- Rubric Display -->
        <div class="section" id="rubric-display" style="display: none;">
            <h2>Rubric</h2>
            <p id="rubric-content"></p>
        </div>

        <!-- Rubric Demonstration -->
        <div class="section" id="rubric-example" style="display: none;">
            <h2>Demonstration</h2>
            <p id="rubric-example"></p>
        </div>

        <!-- User Response Input -->
        <div class="section" id="user-input" style="display: none;">
            <h2>Start Grading</h2>
            <div style="margin-bottom: 1rem;">
                <button id="inputTextBtn">Input Text</button>
                <button id="uploadFileBtn">Upload File</button>
            </div>
            <div id="textInputArea" style="display: none;">
                <textarea placeholder="Write your target response here..."></textarea>
            </div>
            <div id="fileInputArea" style="display: none;">
                <input type="file" id="fileUploadInput" accept=".txt,.doc,.docx,.pdf" />
            </div>
            <br>
            <button id="autoGradeBtn" style="display: none;">Grade</button>
        </div>

        <div class="section" id="result-display" style="display: none;">
            <h2>Result</h2>
            <p id="result-display">Grading...</p>
        </div>

    </div>
    <script>
        document.getElementById('task-select').addEventListener('change', function () {
            // Reset rubric and example displays
            document.getElementById('rubric-display').style.display = 'none';
            document.getElementById('rubric-example').style.display = 'none';
            document.getElementById('toggle-rubrics').textContent = 'Show Details';

            // Reset text/file input areas
            if (document.getElementById('task-select').value == "") {
                document.getElementById('user-input').style.display = 'none';
                document.getElementById('toggle-rubrics').style.display = 'none';
            } else {
                document.getElementById('user-input').style.display = 'block';
                document.getElementById('toggle-rubrics').style.display = 'block';
                selectTask();
            }
            document.getElementById('textInputArea').style.display = 'none';
            document.getElementById('fileInputArea').style.display = 'none';

            // Hide the grade button and result
            document.getElementById('autoGradeBtn').style.display = 'none';
            document.getElementById('result-display').style.display = 'none';


            // Optional: clear the textarea value
            const textarea = document.querySelector('#textInputArea textarea');
            if (textarea) {
                textarea.value = '';
            }

            // Optional: reset file input
            const fileInput = document.getElementById('fileUploadInput');
            if (fileInput) {
                fileInput.value = '';
            }
        });

        document.getElementById('toggle-rubrics').addEventListener('click', function () {
            const rubricDisplay = document.getElementById('rubric-display');
            const rubricExample = document.getElementById('rubric-example');
            const isHidden = rubricDisplay.style.display === 'none';

            rubricDisplay.style.display = isHidden ? 'block' : 'none';
            rubricExample.style.display = isHidden ? 'block' : 'none';
            this.textContent = isHidden ? 'Hide Details' : 'Show Details';
        });

        const inputTextBtn = document.getElementById('inputTextBtn');
        const uploadFileBtn = document.getElementById('uploadFileBtn');
        const autoGradeBtn = document.getElementById('autoGradeBtn');
        const textInputArea = document.getElementById('textInputArea');
        const fileInputArea = document.getElementById('fileInputArea');
        const resultArea = document.getElementById("result-display")

        inputTextBtn.addEventListener('click', function () {
            textInputArea.style.display = 'block';
            fileInputArea.style.display = 'none';
            autoGradeBtn.style.display = 'block';
            resultArea.style.display = 'none';
        });

        uploadFileBtn.addEventListener('click', function () {
            textInputArea.style.display = 'none';
            fileInputArea.style.display = 'block';
            autoGradeBtn.style.display = 'block';
            resultArea.style.display = 'none';
        });

        autoGradeBtn.addEventListener('click', function () {
            resultArea.style.display = 'block';
            // trigger the grading
            runTask()
        });
    </script>
</body>

</html>